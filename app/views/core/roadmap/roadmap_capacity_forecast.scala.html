@* LICENSE
 *
 * Copyright (c) 2015, The Agile Factory SA and/or its affiliates. All rights
 * reserved.
 *
 * This program is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License as published by the Free Software
 * Foundation; version 2 of the License.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE. See the GNU General Public License for more
 * details.
 *
 * You should have received a copy of the GNU General Public License along with
 * this program. If not, see <http://www.gnu.org/licenses/>.
 *@
@(
    capacityForecastForm: Form[controllers.core.RoadmapController.CapacityForecastForm]
)

@import commons._
@import framework_views.parts
@import framework.utils.SideBar
@import framework.utils.Menu.ClickableMenuItem

@sidebarInstance=@{
    val sidebarInstance=new SideBar()
    sidebarInstance.addMenuItem(new ClickableMenuItem(
        "topmenubar.roadmap.menu.label",
        controllers.core.routes.RoadmapController.index().url,
        "fa fa-road",
        true)
    );
    sidebarInstance.addMenuItem(new ClickableMenuItem(
        "core.roadmap.planning.title",
        controllers.core.routes.RoadmapController.viewPlanning().url,
        "fa fa-calendar",
        false)
    );
    sidebarInstance
}

@breadcrump=@{
    Seq(
        ("core.roadmap.breadcrumb", controllers.core.routes.RoadmapController.index().url),
        ("core.roadmap.simulator.capacity_forecast", null)
    )
}

@templates.main_bc_iconsbar(
    parts.Msg.asString("topmenubar.roadmap.menu.label"),
    sidebarInstance,
    breadcrump
){
}{

<span id="roadmap-capacity"></span>

@helper.form(action = controllers.core.routes.RoadmapController.simulatorCapacityForecast(), 'class -> "form-inline pull-right") {

    <input type="hidden" name="selectedRows" value="@capacityForecastForm("selectedRows").value"/>
    
    @parts.dropdownlist(capacityForecastForm("year"), parts.Msg.asString("core.roadmap.simulator.capacity_forecast.year.label"), controllers.core.RoadmapController.CapacityForecastForm.getYears())
    
    &nbsp; &nbsp; &nbsp;
    
    @parts.checkbox(
        capacityForecastForm("onlyConfirmed"), 
        parts.Msg.asString("core.roadmap.simulator.capacity_forecast.only_confirmed.label"), 
        ""
    )
    
    &nbsp; &nbsp; &nbsp;
    
    <div class="form-group">
        <input class="btn btn-default" type="submit" value="@parts.Msg("button.change")" />
        <span class="help-block text-muted"></span>
    </div>

}

<div class="clearfix"></div>

<ul class="nav nav-tabs">
    <li class="active" >
        <a href="#org-units-content" id="org-units-tab" data-toggle="tab" aria-controls="org-units-content" aria-expanded="true">
            @parts.Msg("core.roadmap.simulator.capacity_forecast.org_units.label")
        </a>
    </li>
    
    <li  >
        <a href="#competencies-content" id="competencies-tab" data-toggle="tab" aria-controls="competencies-content">
           @parts.Msg("core.roadmap.simulator.capacity_forecast.competencies.label")
        </a>
    </li>

    <li >
        <a href="#actors-content" id="actors-tab" data-toggle="tab" aria-controls="actors-content">
            @parts.Msg("core.roadmap.simulator.capacity_forecast.actors.label")
        </a>
    </li>
</ul>

<br/>

<div class="tab-content">
    <div class="tab-pane fade in active" id="org-units-content" aria-labelledby="org-units-tab"></div>

    <div class="tab-pane fade" id="competencies-content" aria-labelledby="competencies-tab"></div>

    <div class="tab-pane fade" id="actors-content" aria-labelledby="actors-tab"></div>
</div>

@roadmap_capacity_forecast_js()

<script>
    function maf_capacityForecastLoadCellDetails(e, url) {

        $(".cell").css('border','inherit');
        $(".cell").css('font-weight','normal');
        $(e).parent().css('font-weight','bold');
        $(e).parent().css('border','1px solid #aaa');

        $('#capacity-forecast-cell-details').html('<img src="@_fattach.getAjaxWaitImageUrl()"/>');
        
        $.ajax({
            url: url,
            type: "POST",
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify({"selectedRows" : @Html(capacityForecastForm("selectedRows").value)}),
            success: function (data) {
                $("#capacity-forecast-cell-details").html(data);
            }
        });
    }

    $('a[id="actors-tab"]').on('show.bs.tab', function (e) {
        reloadActorsTable(@Html(capacityForecastForm("selectedRows").value), @Html(capacityForecastForm("year").value), @Html(capacityForecastForm("onlyConfirmed").value));
    });

    $('a[id="org-units-tab"]').on('show.bs.tab', function (e) {
        reloadOrgUnitsTable(@Html(capacityForecastForm("selectedRows").value), @Html(capacityForecastForm("year").value), @Html(capacityForecastForm("onlyConfirmed").value));
    });

    $('a[id="competencies-tab"]').on('show.bs.tab', function (e) {
        reloadCompetenciesTable(@Html(capacityForecastForm("selectedRows").value), @Html(capacityForecastForm("year").value), @Html(capacityForecastForm("onlyConfirmed").value));
    });

    reloadOrgUnitsTable(@Html(capacityForecastForm("selectedRows").value), @Html(capacityForecastForm("year").value), @Html(capacityForecastForm("onlyConfirmed").value));

</script>

<div id="capacity-forecast-cell-details"></div>

<br/>
<a class="btn btn-default" href="@controllers.core.routes.RoadmapController.index()">@parts.Msg("button.back")</a>

}
