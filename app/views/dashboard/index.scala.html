@(currentDashboardPageId: Long, 
	currentDashboardPageIsHome: Boolean, 
	currentDashboardPageName: String, 
	currentDashboardPageConfiguration: List[framework.services.plugins.IDashboardService.DashboardRowConfiguration], 
	dashboardPages: List[org.apache.commons.lang3.tuple.Triple[String, Boolean, Long]],
	configureUrl: String,
	errorUrl: String)

@import framework_views.parts
@import helper._
@import bootstrap3._

@templates.main_bc_nosidebar(
    "Dashbaord",
    Seq(
        ("Dashboard",null)
    )
){
<script src="@routes.Assets.versioned("javascripts/interact.js")"></script>
<script src="@routes.Assets.versioned("javascripts/dashboard.js")"></script>
<link href="@routes.Assets.versioned("stylesheets/dashboard.css")" type="text/css" rel="stylesheet">
}{
<div class="row">
	<div class="col-md-6">
		<div class="btn-group" data-toggle="buttons">
			@for(pair <- dashboardPages){
				@if(pair.getMiddle()){
				<label class="btn btn-primary active"> <input type="radio"
					name="options" id="page-@pair.getRight()" autocomplete="off"  @if(currentDashboardPageId==pair.getRight()){checked}>
					@pair.getLeft()
				</label>
				}
			}
			@for(pair <- dashboardPages){
				@if(!pair.getMiddle()){
				<label class="btn btn-primary active"> <input type="radio"
					name="options" id="page-@pair.getRight()" autocomplete="off"  @if(currentDashboardPageId==pair.getRight()){checked}>
					@pair.getLeft()
				</label>
				}
			}
		</div>
	</div>
	<div class="col-md-6">
		<p class="text-right">
			<a id="_maf_widget_edition_mode" class="btn btn-primary" href="#"><i class="fa fa-cog"></i>&nbsp;Edit
				page</a>
		</p>
	</div>
</div>
<div class="row">
	<div id="workspace" class="col-md-12">
	&nbsp;
	</div>
</div>
<div class="row">
	<div id="workspace" class="col-md-12">
		@for(rowConfig <- currentDashboardPageConfiguration){
			@row(rowConfig.getLayout().getColumnsSizes())
		}
	</div>
</div>
<script type="text/javascript">
	var _dashboardServiceInstance={};
	$(document).ready(function() {
		_dashboardServiceInstance=new _maf_widget_dashboardService(@currentDashboardPageId, "@configureUrl","@errorUrl");
		_dashboardServiceInstance.refresh(function (){
			//Add the widgets to the dashboard page
			var rowIndex=0;
			$("._maf_widget_dashboard_row").each(function(){
				var widgetIndex=0;
				var rowConfig=_dashboardServiceInstance.dashboardData[rowIndex];
				$(this).children("._maf_widget_widget_area").each(function(){
					var widget=rowConfig.widgets[widgetIndex];
					if(widget.id!=-1){
						_maf_widget_loadWidgetContent($(this), widget.url, function(){
							_maf_widgets_toggleEdition(false);
						});
					}
					widgetIndex++;
				});
				rowIndex++;
			});
			//Activate the edition mode selector
			$("#_maf_widget_edition_mode").click(function(event){
				event.preventDefault();
				_dashboardServiceInstance.toggleEditonMode();
			});
			
			//Dashboard row template selector
			$('#dashboardRowTemplateSelectorCloseButton').click(function(event){
				$('#dashboardRowTemplateSelector').modal('hide');
			});
			$('#dashboardRowTemplateSelectorAddButton').click(function(event){
				var modal = $('#dashboardRowTemplateSelector');
				modal.modal('hide');
				var dashboardRowElement=modal.data("mafSourceDashboardRowElement");
				var templateName=$("#dashboardRowTemplateSelector input:radio[name='dashboardRowOption']:checked").val();
				_maf_widget_addDashboardRow(dashboardRowElement, templateName);
			});
			
			//Widget catalog
			$('#widgetCatalogCloseButton').click(function(){
				$('#widgetCatalog').modal('hide');
			});
			$('#widgetCatalogAddButton').click(function(){
				var modal = $('#widgetCatalog');
				modal.modal('hide');
				var widgetAreaElement=modal.data("mafSourceWidgetAreaElement");
				var newWidgetIdentifier=$('#widgetCatalogSelect').val();
				_maf_widget_addNewWidget(widgetAreaElement, _dashboardServiceInstance.loadedWidgetCatalog[newWidgetIdentifier]);
			});
			$('#widgetCatalogSelect').change(function(event){
			    var optionSelected = $(this).find("option:selected");
				var widgetCatalogEntryIdentifier  = optionSelected.val();
				var widgetCatalogEntryName   = optionSelected.text();
				$('#widgetCatalogEntryName').html(widgetCatalogEntryName);
				$('#widgetCatalogEntryDescription').html(_dashboardServiceInstance.loadedWidgetCatalog[widgetCatalogEntryIdentifier].description);
				$('#widgetCatalogEntryImage').html('<img src="'+_dashboardServiceInstance.loadedWidgetCatalog[widgetCatalogEntryIdentifier].image+'"/>');
			});
		});
	});
</script>

<!-- The dashboard row template selector -->
<div id="dashboardRowTemplateSelector" class="modal fade" tabindex="-1" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Dashboard row template</h4>
      </div>
      <div class="modal-body">
      	@for((template, index) <- models.framework_models.plugin.DashboardRowTemplate.values().zipWithIndex){
        <div class="row" style="padding: 1em;">
          <div class="col-md-12">
          	<div class="radio">
			  <label>
			    <input type="radio" name="dashboardRowOption" value="@template.name" @if(index==0){checked}>
			  </label>
			</div>
          </div>
          <div class="col-md-12">
          	<div class="row _maf_widget_dashboard_template_row">
          		@for(columnSize <- template.getColumnsSizes()){
          		<div class="col-md-@columnSize _maf_widget_dashboard_template_cell text-center">&nbsp;<i class="fa fa-navicon"></i>&nbsp;</div>
          		}
          	</div>
          </div>
          <div class="col-md-12"><br/></div>
        </div>
        }
      </div>
      <div class="modal-footer">
        <button type="button" id="dashboardRowTemplateSelectorCloseButton" class="btn btn-default">Close</button>
        <button type="button" id="dashboardRowTemplateSelectorAddButton" class="btn btn-primary">Add row</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<!-- The widget catalog -->
<div id="widgetCatalog" class="modal fade" tabindex="-1" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Widget catalog</h4>
      </div>
      <div class="modal-body">
        <div class="row" style="padding: 1em;">
          <div class="col-md-6">
          	<select id="widgetCatalogSelect" size="10" class="form-control">
			</select>
          </div>
          <div class="col-md-6">
          	<h4 id="widgetCatalogEntryName"></h4>
          	<p style="font-style: italic;" id="widgetCatalogEntryDescription"></p>
          	<p id="widgetCatalogEntryImage" class="text-center"></p>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" id="widgetCatalogCloseButton" class="btn btn-default">Close</button>
        <button type="button" id="widgetCatalogAddButton" class="btn btn-primary">Add widget</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
}