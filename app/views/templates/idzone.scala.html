@* LICENSE
 *
 * Copyright (c) 2015, The Agile Factory SA and/or its affiliates. All rights
 * reserved.
 *
 * This program is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License as published by the Free Software
 * Foundation; version 2 of the License.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE. See the GNU General Public License for more
 * details.
 *
 * You should have received a copy of the GNU General Public License along with
 * this program. If not, see <http://www.gnu.org/licenses/>.
 *@
@()

@import commons._
@import framework_views.parts
@import be.objectify.deadbolt.java.views.html._
@import be.objectify.deadbolt.core.utils.TemplateUtils._

@idZoneData=@{
    controllers.Application.getIDZoneData();
}

@log=@{
    play.Logger.of("IDZONEDEBUG")
}

@applicationLogo=@{models.framework_models.account.Preference.getPreferenceValueFromUuid(constants.IMafConstants.APPLICATION_LOGO_PREFERENCE, _cache, _usession, _accmngr);}
@log.debug("BEGIN>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>")
<div id="idzone_wrapper">
    <div class="container" style="width: 100%; margin-left: 0; margin-left: 0;">
        <div class="row">
            <div class="col-sm-2">
               @applicationLogo.renderDisplay()
            </div>
            <div  class="col-sm-3">
                @if(idZoneData!=null && idZoneData.pluginMenuDesriptors!=null && idZoneData.pluginMenuDesriptors.size()!=0){
                    <select id="idzone_appselector">
                        <option value="@constants.IMafConstants.MAF_GOVERNANCE_MODULE_CONFIGURATION">@parts.Msg("main.application.title.header")</option>
                        @for((pluginConfigurationId, pairOfPluginInformation) <- idZoneData.pluginMenuDesriptors){
                        <option value="@pluginConfigurationId">@parts.Msg(pairOfPluginInformation.getRight().getLabel())</option>
                        }
                    </select>
                }
            </div>
            @log.debug("A>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>")
            <div class="col-sm-7">
                @if(idZoneData!=null) {
                
                    <div class="pull-right">
                        <div class="btn-group" id="menu-messages">
                            <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                                <span class="glyphicons glyphicons-envelope glyphicons-button-small"></span> @parts.Msg("idzone.messages.title") 
                                @if(idZoneData.nbNotReadMessages > 0) { &nbsp;<span class="badge">@idZoneData.nbNotReadMessages</span> }
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu pull-right" style="z-index: 1001;">
                                @if(idZoneData.nbNotReadMessages > 0) {
                                    @for(message <- idZoneData.messages) {
                                        <li><a href="@routes.MessagingController.index().url"><span class="glyphicons glyphicons-envelope glyphicons-button-small"></span> @message.getTitle</a></li>
                                    }
                                } else {
                                    <li class="dropdown-header">@parts.Msg("idzone.messages.not_read.empty")</li>
                                }
                                <li class="divider"></li>
                                <li><a href="@routes.MessagingController.index().url"><span class="glyphicons glyphicons-conversation glyphicons-button-small"></span> @parts.Msg("idzone.messages.messaging")</a></li>
                            </ul>
                        </div>
                        @if(_notificationService.isInternalSendingSystem) {
                            @log.debug("B>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>")
                            &nbsp;
                            <div class="btn-group" id="menu-notifications">
                                <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                                    <span class="glyphicons glyphicons-bell glyphicons-button-small"></span> @parts.Msg("idzone.notifications.title") 
                                    @if(idZoneData.nbNotReadNotifications > 0) { &nbsp;<span class="badge">@idZoneData.nbNotReadNotifications</span> }
                                    <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu pull-right" style="z-index: 1001;">
                                    @if(idZoneData.nbNotReadNotifications > 0) {
                                        @for(notification <- idZoneData.notifications) {
                                            <li><a href="@routes.Application.redirectForNotification(notification.id).url">
                                                @if(notification.notificationCategory != null) {
                                                    <span class="@notification.notificationCategory.bootstrapGlyphicon glyphicons-button-small"></span>
                                                }
                                                @notification.getTitle
                                            </a></li>
                                        }
                                    } else {
                                        <li class="dropdown-header">@parts.Msg("idzone.notifications.not_read.empty")</li>
                                    }
                                    <li class="divider"></li>
                                    <li><a href="@routes.Application.displayNotifications().url"><span class="glyphicons glyphicons-list glyphicons-button-small"></span> @parts.Msg("idzone.notifications.view_all")</a></li>
                                </ul>
                            </div>
                        }
                        @log.debug("C>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>")
                        &nbsp;
                        <div class="btn-group" id="menu-my">
                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                                <span class="glyphicons glyphicons-user glyphicons-button-small"></span> @idZoneData.login
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu pull-right" style="z-index: 1001;">
                                <li><a href="@controllers.admin.routes.MyAccount.display().url"><i class="glyphicons glyphicons-nameplate glyphicons-button-small"></i>&nbsp; @parts.Msg("idzone.my.myaccount")</a></li>
                                @restrict(la(as(constants.IMafConstants.PERSONAL_SPACE_READ_PERMISSION))){ 
                                    <li><a href="@controllers.my.routes.MyPersonalStorage.index().url"><i class="glyphicons glyphicons-folder-open glyphicons-button-small"></i>&nbsp; @parts.Msg("idzone.my.personalspace")</a></li>
                                }
                                <li class="divider"></li>
                                <li><a href="@play.Play.application().configuration().getString("maf.support.url")" target="_blank"><i class="glyphicons glyphicons-life-preserver glyphicons-button-small"></i>&nbsp; @parts.Msg("idzone.my.support")</a></li>
                                <li class="divider"></li>
                                <li><a href="@idZoneData.logoutUrl"><i class="glyphicons glyphicons-power glyphicons-button-small"></i>&nbsp; @parts.Msg("idzone.my.logout")</a></li>
                            </ul>
                        </div>
                        
                    </div>
                }
            </div>
        </div>
    </div>
    @log.debug("D>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>")
    @if(idZoneData!=null && idZoneData.pluginMenuDesriptors!=null && idZoneData.pluginMenuDesriptors.size()!=0){
    <script type="text/javascript">
        var appLists={};
        appLists[@constants.IMafConstants.MAF_GOVERNANCE_MODULE_CONFIGURATION]='@routes.Redirector.governance().url';
        @for((pluginConfigurationId, pairOfPluginInformation) <- idZoneData.pluginMenuDesriptors){
            appLists['@pluginConfigurationId']='@pairOfPluginInformation.getRight().getPath()';
        }
        $(document).ready(function(){
            $('#idzone_appselector').change(function (){
                document.location=appLists[$('#idzone_appselector').val()];
            });
        });
    </script>
    }
    @log.debug("E>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>")
</div>
@******************************************************
 The ID Zone is a component replicated on the "third party"
 applications which are integrated with BizDock.
 For the third party applications its is implemented
 as a JavaScript include.
 ******************************************************@ 
